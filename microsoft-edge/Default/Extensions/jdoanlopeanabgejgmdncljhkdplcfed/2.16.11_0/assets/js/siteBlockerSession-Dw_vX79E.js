import{d as e,k as t,p as s,l as i,m as r}from"./icon-alert-BG5stABd.js";import{e as o,g as a,F as n}from"./index-DgGUECrr.js";import{u as c,a as l}from"./siteBlockerGroups-DPpCFrY4.js";import{S as p,a as d,b as u}from"./constants-BT5o8PmI.js";import{useFocusModeDashViewStateStore as g}from"./focusModeViewState-CWig-aWL.js";import{u as h}from"./pomodoroCompleted-DPMAO4eq.js";import{g as j}from"./focusModeHelpers-g0L8k_eK.js";import{c as S}from"./reactiveCustomization-BIBQ0lmK.js";import"./localStorage-BWL8dYsz.js";import"./preload-helper-DmNsytk6.js";import"./string-VUUyAM1F.js";import"./main-CWen-4ha.js";import"./compareObjects-BF7sSNEf.js";import"./ViewState-lXKIKVsa.js";import"./VueBase-Qr0J4kll.js";import"./index-CJJH83pl.js";import"./portal-vue.esm-CE661Bdg.js";import"./scenes-D8jpYIdj.js";import"./ocean-bubbles-GcKjBI5B.js";import"./PomodoroTimers-BWkB-14p.js";import"./loginHelpers-CfKnwmAb.js";import"./authService-DyVsAij2.js";import"./customization-D19fk4LU.js";const b=new o(p,!1),f=new o(d,""),v=e("siteBlockerSession",{state:()=>({active:b.currentValue,hasPermissions:!1}),getters:{urls:()=>[...c().items.reduce(((e,t)=>t.enabled?(l().getWebsitesByGroup(t).filter((e=>e.enabled)).forEach((t=>e.add(t.hostWithWildcard))),e):e),new Set([]))].join(" "),settingsEnabled:()=>S.siteBlockerVisible,focusModeEnabledAndFocusModeSettingActive:()=>a.currentValue&&j().apps.siteBlocker.enabled&&g().activeViewId===n.Focusing.toString(),featureEnabled:()=>m.conditionalFeatures.featureEnabled("site-blocker")||a.currentValue,activeAndBlockingUrls:e=>e.active&&e.hasPermissions&&0!==c().items.length},actions:{toggleActive(e){const t=e??!this.active;t&&this.checkSiteBlockerFeatureDisabledAndOpenUpsell()||(t&&this.registerOrUpdateContentScript(),this.active=t)},async ensurePermissions(e=!1){return this.hasPermissions?await this.registerOrUpdateContentScript():new Promise((t=>{m.cmd("modal.open","PERMISSION_REQUEST",{widgetName:"Site Blocker",permissionExplanation:"To block sites while focusing",permissions:u,requestImmediately:e,resolve:async e=>{if(!e)return t(!1);this.hasPermissions=!0,await this.registerOrUpdateContentScript(),t(!0)}})}))},async registerOrUpdateContentScript(){if(!t().scripting)return;const e=await t().scripting.getRegisteredContentScripts();return await new Promise((s=>{t().scripting[e.length?"updateContentScripts":"registerContentScripts"]([{id:"site-blocker",js:["/content-scripts/siteBlocker.js"],matches:["*://*/*"],runAt:"document_start"}],(()=>s(!0)))}))},checkSiteBlockerFeatureDisabledAndOpenUpsell(){return!this.featureEnabled&&(m.cmd("modal.open","UPSELL_SITE_BLOCKER",{eventSource:"site-blocker"}),!0)}}});(async()=>{const e=v(),o=c(),n=l(),m=h();b.switchOverToWatchedStoreItem((()=>e.active)),t().permissions&&s.permissions.contains(u).then((t=>e.hasPermissions=t)),await i((()=>m.loaded)).toBe(!0),r([()=>a.currentValue,()=>e.focusModeEnabledAndFocusModeSettingActive,()=>m.anyFocusTimerActive,()=>m.playing,()=>e.featureEnabled,()=>e.settingsEnabled],(([t,s,i,r,o,a])=>{o&&a||e.toggleActive(!1),t&&(s&&i&&r?e.toggleActive(!0):e.toggleActive(!1))})),await i((()=>o.loaded)).toBe(!0),await i((()=>n.loaded)).toBe(!0),f.switchOverToWatchedStoreItem((()=>e.urls))})();export{v as default};