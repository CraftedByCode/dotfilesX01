const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/js/apiUrl-BMfAmzeN.js","assets/js/localStorage-BWL8dYsz.js"])))=>i.map(i=>d[i]);
import{_ as e,g as t}from"./preload-helper-DmNsytk6.js";import{r as a,e as o,i as s,L as r}from"./localStorage-BWL8dYsz.js";const n="user:migration:",i={TIME:n+"time",FOCUS:n+"focus",ONBOARDING:n+"onboarding"},c=6e4,l=100,u={REGISTER:"register",FOCUS:"focus",ONBOARDING:"onboarding"},m="tab.legacyUserMigration",g="syncedData:migration:lastAttempted",d="syncedData:migration:successful";async function f({context:n,tabId:i,loggerName:c},l){try{const r=await async function(r){const n=localStorage.getObject("momentum-customization-1").displayname,i=(await e((async()=>{const{default:e}=await import("./apiUrl-BMfAmzeN.js");return{default:e}}),__vite__mapDeps([0,1]))).default(),c=await a({method:"post",url:i+"user:migrateLegacy?canceled=true",data:{name:n},headers:{"X-Momentum-Version":o.version,"X-Momentum-ClientDate":t(),"X-Momentum-ClientId":localStorage.getItem("client_uuid"),"X-Momentum-TabId":r}});if(s(null==c?void 0:c.status)&&c.data)return localStorage.setItem("token",c.data.token),localStorage.setItem("token_uuid",c.data.token_uuid),localStorage.setItem("unregistered",!0),c.data.settings;throw new Error("Legacy Migration Request Failed",c)}(i);l({success:!0,settings:r})}catch(m){if(console.error(m),c){new r(c).error(n+" migration error",{errorMessage:m.message,stack:m.stack,phase:u.REGISTER})}l({success:!1,error:m})}}const p=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{i as L,g as M,m as a,c as b,l as c,u as d,d as e,p as f,f as m};