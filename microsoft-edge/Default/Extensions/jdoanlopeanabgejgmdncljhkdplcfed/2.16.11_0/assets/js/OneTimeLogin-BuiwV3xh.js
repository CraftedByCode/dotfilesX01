import{A as t,q as e,u as s,x as i,n as o}from"./icon-alert-BG5stABd.js";import{O as a}from"./onboardingStepCollection-Cv4iqhpx.js";import{o as n}from"./oneTimeLoginService-BgvrnwR9.js";import"./localStorage-BWL8dYsz.js";import"./preload-helper-DmNsytk6.js";import"./string-VUUyAM1F.js";import"./VueBase-Qr0J4kll.js";import"./index-DgGUECrr.js";import"./main-CWen-4ha.js";import"./index-CJJH83pl.js";import"./portal-vue.esm-CE661Bdg.js";import"./itemModelMixin-DaIj4M8Z.js";import"./reactiveCustomization-BIBQ0lmK.js";import"./namesMixin-DfNb5KMg.js";import"./itemDataServiceMixins-BlaFviuD.js";import"./icon-asana-Csd73e1k.js";import"./focusModeHelpers-g0L8k_eK.js";import"./scenes-D8jpYIdj.js";import"./ocean-bubbles-GcKjBI5B.js";import"./PomodoroTimers-BWkB-14p.js";import"./constants-CALDQiUE.js";import"./SubscriptionSummary-Do_dB0ks.js";import"./authService-DyVsAij2.js";import"./loginHelpers-CfKnwmAb.js";import"./icon-confetti-Dz2LojDe.js";import"./siteBlockerGroups-DPpCFrY4.js";import"./constants-BT5o8PmI.js";import"./compareObjects-BF7sSNEf.js";const r=new t({feature:"one-time-login"});const p=o(e({name:"OneTimeLogin",props:{subSteps:{type:Array,required:!0},activeSubStepIndex:{type:Number,required:!0},otlParams:{type:Object,default:void 0}},emits:["goToSubStep","dismiss","stepComplete"],setup:()=>({OneTimeLoginState:a,oneTimeLoginData:void 0,helpUrl:"https://get.momentumdash.help/hc/en-us/articles/19764520037143"}),computed:{activeSubStep(){var t;return(null==(t=this.subSteps[this.activeSubStepIndex])?void 0:t.name)??a.ERROR}},async mounted(){var t;await this.redeemOneTimePassword();const e=s.userIsLegacyUnregistered()||!!localStorage.getItem("unregistered"),i=null==(t=this.oneTimeLoginData)?void 0:t.legacy;!e||i?await this.oneTimeLogin():this.setSubStep(a.UNSAVED_DATA)},methods:{setSubStep(t){const e=this.subSteps.findIndex((e=>e.name===t));-1!==e&&this.$emit("goToSubStep",e)},dismiss(){this.$emit("dismiss")},complete(){this.$emit("stepComplete")},displayErrorSubStep(t){let e="string"==typeof t?t:"unknown error";t instanceof Error&&(null==t?void 0:t.message)&&(e=t.message);const s=i(t,{default:e});console.error(s),r.capture("one time login error",{message:s.message}),this.setSubStep(a.ERROR)},goToRegistration(){m.cmd("modal.open","LOGIN",{force:!0})},async redeemOneTimePassword(){try{if(!this.otlParams)return this.displayErrorSubStep("no otl params defined");r.capture("one time password redeemed"),this.setSubStep(a.PROCESSING),n.startOneTimeLogin(),this.oneTimeLoginData=await n.redeemOnetimePassword(this.otlParams)}catch(t){this.displayErrorSubStep(t)}},async oneTimeLogin(){try{if(!this.oneTimeLoginData)return this.displayErrorSubStep("no one time login data");r.capture("one time login activated"),this.setSubStep(a.PROCESSING),await n.loginWithOneTimeLoginResponse(this.oneTimeLoginData),n.finalizeOneTimeLogin(),this.complete()}catch(t){this.displayErrorSubStep(t)}}}}),(function(){var t=this,e=t._self._c;return t._self._setupProxy,e("div",{staticClass:"one-time-login app reset-app-styles dark",attrs:{"data-test":"one-time-login"}},[e("transition",{attrs:{name:"fade",mode:"out-in",duration:350}},[e("div",{key:t.activeSubStep,staticClass:"content",attrs:{"data-test":t.activeSubStep}},[t.activeSubStep===t.OneTimeLoginState.PROCESSING?[e("h2",[t._v("Logging you in to Momentumâ€¦")])]:t.activeSubStep===t.OneTimeLoginState.UNSAVED_DATA?[e("h2",[t._v("Unsaved data found")]),e("p",[t._v("Create an account to save your data.")]),e("div",{staticClass:"actions"},[e("button",{staticClass:"dash-button dash-button-primary",attrs:{"data-test":"register"},on:{click:t.goToRegistration}},[t._v("Create account and save data")]),e("button",{staticClass:"dash-button",attrs:{"data-test":"proceed"},on:{click:t.oneTimeLogin}},[t._v("Continue without data")])]),e("div",{staticClass:"sub-actions"},[e("button",{attrs:{"data-test":"dismiss"},on:{click:t.dismiss}},[t._v("Cancel login")]),e("a",{attrs:{href:t.helpUrl}},[t._v("Help")])])]:t.activeSubStep===t.OneTimeLoginState.ERROR?[e("h2",[t._v("Oops! Something didn't work")]),e("p",[t._v("If the problem persists, please contact us.")]),e("div",{staticClass:"actions horizontal"},[e("button",{staticClass:"dash-button dash-button-primary",attrs:{"data-test":"dismiss"},on:{click:t.dismiss}},[t._v("Dismiss")]),e("a",{staticClass:"dash-button",attrs:{href:"https://momentumdash.com/contact","data-test":"contact-us"}},[t._v("Contact us")])]),e("div",{staticClass:"sub-actions"},[e("a",{attrs:{href:t.helpUrl}},[t._v("Help")])])]:t._e()],2)])],1)}),[],!1,null,"f0ce44d4").exports;export{p as default};